<?php
/**
 * Copyright Â© Magento, Inc. All rights reserved.
 * See COPYING.txt for license details.
 */

/**
 * @var \Magento\Rma\Block\Adminhtml\Rma\Edit\Tab\General\Shipping\Grid $block
 * @var \Magento\Framework\View\Helper\SecureHtmlRenderer $secureRenderer
 */
?>
<div class="grid">
    <?php $randomId = rand(); ?>
    <div class="admin__table-wrapper">
        <table id="packaging-data-grid-<?= /* @noEscape */ $randomId ?>" class="data-grid">
            <thead>
            <tr>
                <th class="data-grid-checkbox-cell">
                    <label class="data-grid-checkbox-cell-inner">
                        <input type="checkbox"
                               id="select-items-<?= /* @noEscape */ $randomId ?>"
                               class="checkbox admin__control-checkbox"
                               title="<?= $block->escapeHtmlAttr(__('Select All')) ?>">
                        <label for="select-items-<?= /* @noEscape */ $randomId ?>"></label>
                    </label>
                    <?= /* @noEscape */
                    $secureRenderer->renderEventListenerAsTag(
                        'onchange',
                        'packaging.checkAllItems(this)',
                        '#select-items-' . $randomId
                    ); ?>
                </th>
                <th class="data-grid-th"><?= $block->escapeHtml(__('Product Name')) ?></th>
                <th class="data-grid-th"><?= $block->escapeHtml(__('Weight')) ?></th>
                <th class="data-grid-th custom-value">
                    <?= $block->escapeHtml(__('Customs Value')) ?>
                </th>
                <th class="data-grid-th"><?= $block->escapeHtml(__('Qty Ordered')) ?></th>
                <th class="data-grid-th"><?= $block->escapeHtml(__('Qty')) ?></th>
            </tr>
            </thead>
            <?php if (!$block->displayCustomsValue()): ?>
                <?= /* @noEscape */
                $secureRenderer->renderStyleAsTag(
                    'display:none',
                    '#packaging-data-grid-' . $randomId . ' th.custom-value'
                ) ?>
            <?php endif; ?>

            <tbody>
            <?php $i = 0; ?>
            <?php foreach ($block->getCollection() as $item): ?>
                <tr class="data-grid-controls-row data-row <?= ($i++ % 2 != 0) ? '_odd-row' : ''; ?>">
                    <td class="data-grid-checkbox-cell">
                        <?php $id = $item->getId(); ?>
                        <label class="data-grid-checkbox-cell-inner">
                            <input type="checkbox"
                                   id="select-item-<?= /* @noEscape */ $randomId . '-' . $id ?>"
                                   value="<?= (int)$id ?>"
                                   class="checkbox admin__control-checkbox">
                            <label for="select-item-<?= /* @noEscape */ $randomId . '-' . $id ?>"></label>
                        </label>
                    </td>
                    <td>
                        <?= $block->escapeHtml($item->getName()) ?>
                    </td>
                    <td data-role="item-weight">
                        <?= $block->escapeHtml($item->getWeight()) ?>
                    </td>
                    <?php $customsValueValidation = $block->displayCustomsValue()
                        ? ' validate-zero-or-greater '
                        : '';
                    ?>
                    <td id="custom-value-<?= /* @noEscape */ $randomId . '-' . $id ?>" class="custom-value">
                        <?php $formattedPrice = $block->formatPrice($item->getPrice()); ?>
                        <input type="text"
                               name="customs_value"
                               class="input-text <?= /* @noEscape */ $customsValueValidation ?>"
                               value="<?= $block->escapeHtmlAttr($formattedPrice) ?>"
                               size="10">
                    </td>
                    <?php if (!$block->displayCustomsValue()): ?>
                        <?= /* @noEscape */ $secureRenderer->renderStyleAsTag(
                            'display:none',
                            'td#custom-value-' . $randomId . '-' . $id
                        ) ?>
                    <?php endif ?>
                    <td>
                        <?= $block->escapeHtml($item->getQty()) ?>
                    </td>
                    <td>
                        <input type="hidden"
                               name="price"
                               value="<?= $block->escapeHtmlAttr($item->getPrice()) ?>">
                        <input type="text"
                               name="qty"
                               value="<?= /* @noEscape */ $item->getQty() * 1 ?>"
                               class="admin__control-text input-text qty qty-decimal">
                        <button id="delete-item<?= /* @noEscape */ $randomId . '-' . $id ?>"
                                type="button"
                                data-action="package-delete-item"
                                class="action-delete">
                            <span><?= $block->escapeHtml(__('Delete')) ?></span>
                        </button>
                        <?= /* @noEscape */
                        $secureRenderer->renderStyleAsTag(
                            'display:none',
                            'button#delete-item' . $randomId . '-' . $id
                        ) ?>
                    </td>
                </tr>
            <?php endforeach; ?>
            </tbody>
        </table>
        <?php $scriptString = <<<script
        require(['jquery'], function ($) {
            $("#packaging-data-grid-{$randomId}").on('blur', 'td.custom-value input',
                function(){packaging.recalcContainerWeightAndCustomsValue(this)});
            $("#packaging-data-grid-{$randomId}").on('click', 'button[data-action="package-delete-item"]',
                function(){packaging.deleteItem(this)});
        });
script;
        ?>
        <?= /* @noEscape */
        $secureRenderer->renderTag('script', [], $scriptString, false) ?>
    </div>
</div>
